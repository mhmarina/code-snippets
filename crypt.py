from Crypto.Cipher import AES
from Crypto.PublicKey import RSA
from Crypto.Random import get_random_bytes
from Crypto.Util.strxor import strxor
from Crypto.Util.Padding import pad, unpad
from Crypto.Hash import SHA256
import base64
import json
from pwn import *

user_key = RSA.generate(1024)
user_certificate = {
    "name" : "Marina",
    "key" : {
        "e": user_key.e,
        "n": user_key.n,
    },
    "signer" : "root",
}
user_certificate_hash = SHA256Hash(json.dumps(user_certificate).encode()).digest()

user_cert_b64 = base64.b64encode(json.dumps(user_certificate).encode())
print(user_cert_b64)

root_d = 0x1c4b8c22b4e3855bc3313d1138c09b112f06a60c400d902a64d44b72356f91eedba6d376ebbf5ecca321d734b1e84aba1ee93d2d62754aac014c80d5f98111e6fe57dd376b7a9bf3b2fb6bf6228e56e345cfc5f171ae18701de2d6c6d6f19fb1c5d0f4157dedf676f2b167c62b934a9b5d1640cad19c8528ce17fd6123b31445bfcd250fa71e3ce5f188e411c242baf58eea2398faf041748ced4b567921e72483a0019decd0d8e182fe0c7ba2aebec8643c8991b02d6fd72a7e6c756da0371e8824b51e3352daa04099b977d8762062608f510149f84ff9f32c3fd3491e4e8c03fedc727a2759747b8ceb99c0a1df850904225ba17658156224129f44ac101
root_certificate = base64.b64decode("eyJuYW1lIjogInJvb3QiLCAia2V5IjogeyJlIjogNjU1MzcsICJuIjogMjQ1NDgzNzg1MDAyMTEyMjk2MDc1NTAzMDE2MTg4NDE4OTIwMDgyODIwOTU4NjgzNTMwNTQ1NjU5OTU5MTE4MzAyOTU4NjExOTI5NjI5NzgyMDk5MTIzMDQyMzUzOTIxNDg5NzQ0OTEzNTg3Mjk5NjUxOTkwNTMwNDE3OTM1MzU4Njc5MjAyNjMyODg1MjE4MjU4NTc3MDQwMjk5NzEyNDA0NjMxMDAzMjQ0MDgxMDQxODEyMDgzNzcxOTI5MDc0MjA3ODMyMTkxMjI1MzY4OTgzMjAxNDQ5NDc5MTc3MTczMzY2NTc0MDIxNDAxOTU1ODMyODc4OTQ1OTM0ODg3OTc1MTY2OTczMTI4Mjk1OTgyODg4Mzc5NjkwMDM2NDY4NjcyMjczNjgwOTE2ODEwNzU0MTcxODU3NjA5NjEwODQ5MjAwMDI0NzYxMzc5NjI1OTA3MTYwNjgxNjM4ODEwOTk0NzI4OTMwMzU0MDc5NDEyNTI4ODI4MjMzNDk1ODg3MzE4ODY1NDQwNzYwMzE1OTUyNDA2MTQ5Njc0NjQ2OTQ0MTY5MTM0MjMxNzkyNzE5OTE3NjQyMTM5MzU5NTg5MjcxOTYxODY2ODY0NzQ2NjYxMTc2OTM0MjM5MDU0MjcxNDEyNzMyNzY5MDg3MTcyMTg2MDgxNDMyNzc2NzY1NzA3Mjk0ODA4MjMxMDkzNTcxMzU2NTA4MzAyMjAyNzkwMjYzMDE2ODI1MTU4NDE3ODI5MjMyNTgzNTYwMjMwOTQ2ODUzMTgwMTE2OTcwMzIzMTI2ODg5MjY4MjcyODYyMjM0NzI0NjM3NTF9LCAic2lnbmVyIjogInJvb3QifQ==") 
root_n = 24548378500211229607550301618841892008282095868353054565995911830295861192962978209912304235392148974491358729965199053041793535867920263288521825857704029971240463100324408104181208377192907420783219122536898320144947917717336657402140195583287894593488797516697312829598288837969003646867227368091681075417185760961084920002476137962590716068163881099472893035407941252882823349588731886544076031595240614967464694416913423179271991764213935958927196186686474666117693423905427141273276908717218608143277676570729480823109357135650830220279026301682515841782923258356023094685318011697032312688926827286223472463751

user_certificate_signature = pow(
        int.from_bytes(user_certificate_hash, "little"),
        root_d,
        root_n
    ).to_bytes(256, "little")

print(base64.b64encode(user_certificate_signature))